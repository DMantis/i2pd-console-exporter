# i2pd Web Console Prometheus Exporter

A minimal, single-file Prometheus exporter that scrapes metrics from the [i2pd](https://i2pd.website/) default web console.

## Disclaimer

Most of the code was generated by AI, but every line has been manually reviewed. Whether you trust it is up to you.

## Why?

Other exporters exist, but I found them too large and difficult to audit. I wanted a simple, single-file solution that is easy to review in full.

This exporter is intentionally simple: it uses regex to parse the HTML of the i2pd English web console. This means:

- If the web console HTML changes, it will break.
- If you set a language other than English, it will break.

Using the i2pcontrol JSON endpoint would be a more robust approach, but this is good enough for my needs.

## Exported Metrics

| Metric | Type | Description |
|--------|------|-------------|
| `i2pd_up` | gauge | Whether the i2pd console is reachable |
| `i2pd_scrape_duration_seconds` | gauge | Time spent scraping the i2pd console |
| `i2pd_uptime_seconds` | gauge | Router uptime in seconds |
| `i2pd_network_status` | gauge | Network status (1=OK), labeled by `protocol` (v4/v6) |
| `i2pd_tunnel_creation_success_rate_percent` | gauge | Tunnel creation success rate |
| `i2pd_traffic_bytes_total` | counter | Total traffic in bytes, labeled by `direction` (received/sent/transit) |
| `i2pd_traffic_bytes_per_second` | gauge | Traffic rate in bytes/s, labeled by `direction` |
| `i2pd_routers` | gauge | Number of known routers |
| `i2pd_floodfills` | gauge | Number of known floodfills |
| `i2pd_leasesets` | gauge | Number of known lease sets |
| `i2pd_client_tunnels` | gauge | Number of client tunnels |
| `i2pd_transit_tunnels` | gauge | Number of transit tunnels |
| `i2pd_version_info` | gauge | i2pd version (as label) |
| `i2pd_router_caps_info` | gauge | Router capability flags (as label) |
| `i2pd_service_enabled` | gauge | Whether a service is enabled (1=yes, 0=no), labeled by `service` |

## Usage

```
go build -o i2pd-web-exporter .
./i2pd-web-exporter [flags]
```

### Flags

| Flag | Default | Description |
|------|---------|-------------|
| `-listen` | `:9101` | Address to listen on for metrics |
| `-url` | `http://127.0.0.1:7070` | i2pd web console URL |
| `-timeout` | `5s` | HTTP client timeout |

### Example

```
./i2pd-web-exporter -listen :9101 -url http://127.0.0.1:7070
```

Then configure Prometheus to scrape `http://<host>:9101/metrics`.
